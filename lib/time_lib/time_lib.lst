     1                                  ;------------------------------------------------------------------------------
     2                                  ; Object file	:	time_lib.o
     3                                  ; Version		:	0.0
     4                                  ; Created date 	:	2018-01-20
     5                                  ; Last update	:	2018-01-20
     6                                  ; Author		:	Boris
     7                                  ; Description	:	???
     8                                  ;
     9                                  ; Assemble		:	see ../makefile
    10                                  ;------------------------------------------------------------------------------
    11                                  
    12                                  
    13                                  extern cnv_long
    14                                  
    15                                  section .bss
    16                                  
    17                                  									; for print_time 
    18                                  									; ----------------------------------------
    19 00000000 <res 00000008>          	timeval_buf: resb 8				; reserve pointer for timeval structure
    20                                  									; struct timeval {
    21                                  									;	time_t		tv_sec; /* 4 bytes */
    22                                  									;	suseconds_t	tv_usec; /* 4 bytes  */
    23                                  									; }
    24                                  
    25                                  section .data
    26                                  	global print_time				; declaring global access for print_time
    27                                  
    28                                  ;------------------------------------------------------------------------------
    29                                  ; print_time	:	prints timeval concatenated in decimal format to stdout
    30                                  ; updated		:	2018-01-16
    31                                  ; in			:	[none]
    32                                  ; out			:	[none]
    33                                  ; modifies		:	[none]
    34                                  ; calls			:	cnv_long
    35                                  ;
    36                                  
    37                                  print_time:
    38 00000000 50                      	push eax						;
    39 00000001 53                      	push ebx						;
    40 00000002 51                      	push ecx						; preserving registers
    41 00000003 52                      	push edx						;
    42 00000004 56                      	push esi						;
    43                                  
    44 00000005 B04E                    	mov al,0x4e						; sys_gettimeofday code
    45 00000007 BB[00000000]            	mov ebx,timeval_buf				; supplying timeval pointer
    46 0000000C CD80                    	int 0x80						; making call to kernel
    47                                  
    48 0000000E A1[00000000]            	mov eax,dword[timeval_buf]		; loading first part of timeval to eax
    49 00000013 B30A                    	mov bl,0x0a						; loading decimal base to bl
    50 00000015 E8(00000000)            	call cnv_long					; executing conversion function
    51                                  
    52 0000001A B804000000              	mov eax,0x04					;
    53 0000001F BB01000000              	mov ebx,0x01					;
    54 00000024 88CA                    	mov dl,cl						; printing generated string to stdout
    55 00000026 89F1                    	mov ecx,esi						;
    56 00000028 CD80                    	int 0x80						;
    57                                  
    58 0000002A A1[04000000]            	mov eax,dword[timeval_buf+4]	; loading second part of timeval to eax
    59 0000002F B30A                    	mov bl,0x0a						; loading decimal base do bl
    60 00000031 E8(00000000)            	call cnv_long					; executing convertion function
    61                                  
    62 00000036 B804000000              	mov eax,0x04					;
    63 0000003B BB01000000              	mov ebx,0x01					;
    64 00000040 88CA                    	mov dl,cl						; printing generated string to stdout
    65 00000042 89F1                    	mov ecx,esi						;
    66 00000044 CD80                    	int 0x80						;
    67                                  
    68 00000046 5E                      	pop esi							;
    69 00000047 5A                      	pop edx							;
    70 00000048 59                      	pop ecx							; preserving registers
    71 00000049 5B                      	pop ebx							;
    72 0000004A 58                      	pop eax							;
    73 0000004B C3                      	ret								; returning control
